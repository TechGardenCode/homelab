projects:
  1276-dev:
    namespace: argocd
    sourceRepos:
      - https://github.com/techgardencode/homelab.git
    destinations:
      - name: 1276-dev
        namespace: "*"
    clusterResourceWhitelist:
      - group: "*"
        kind: "*"
  1276-prod:
    namespace: argocd
    sourceRepos:
      - https://github.com/techgardencode/homelab.git
    destinations:
      - name: 1276-prod
        namespace: "*"
    clusterResourceWhitelist:
      - group: "*"
        kind: "*"

applicationsets:
  1276-dev:
    name: 1276-dev
    namespace: argocd
    generators:
      - git:
          repoURL: https://github.com/techgardencode/homelab.git
          revision: main
          directories:
            - path: "kubernetes/clusters/1276-dev/**/*"
            - path: "kubernetes/clusters/1276-dev/external-dns/*"
              exclude: true
            - path: "kubernetes/clusters/1276-dev/example/*"
              exclude: true
    template:
      metadata:
        # Keep your naming convention from core: "<namespace>.<leaf-folder>"
        name: "{{path[2]}}.{{path[3]}}.{{path.basenameNormalized}}"
      spec:
        project: "1276-dev"
        source:
          repoURL: https://github.com/techgardencode/homelab.git
          targetRevision: main
          path: "{{path}}"
          plugin:
            name: kustomize-helm
            parameters:
              - name: NAMESPACE
                string: "{{path[3]}}"
        destination:
          name: "1276-dev"
          namespace: "{{path[3]}}"
        syncPolicy:
          automated:
            selfHeal: true
            prune: true
          syncOptions:
            - ApplyOutOfSyncOnly=true
            - ServerSideApply=true
  1276-prod:
    name: 1276-prod
    namespace: argocd
    generators:
      - git:
          repoURL: https://github.com/techgardencode/homelab.git
          revision: main
          directories:
            - path: "kubernetes/clusters/1276-prod/**/*"
            - path: "kubernetes/clusters/1276-prod/example/*"
              exclude: true
    template:
      metadata:
        # Keep your naming convention from core: "<namespace>.<leaf-folder>"
        name: "{{path[2]}}.{{path[3]}}.{{path.basenameNormalized}}"
      spec:
        project: "1276-prod"
        source:
          repoURL: https://github.com/techgardencode/homelab.git
          targetRevision: main
          path: "{{path}}"
          plugin:
            name: kustomize-helm
            parameters:
              - name: NAMESPACE
                string: "{{path[3]}}"
        destination:
          name: "1276-prod"
          namespace: "{{path[3]}}"
        syncPolicy:
          automated:
            selfHeal: true
            prune: true
          syncOptions:
            - ApplyOutOfSyncOnly=true
            - ServerSideApply=true
  main:
    name: main
    generators:
      - git:
          repoURL: https://github.com/techgardencode/homelab.git
          revision: main
          directories:
            - path: "kubernetes/clusters/1276-core/**/*"
            - path: "kubernetes/clusters/1276-core/external-dns/*"
              exclude: true
            - path: "kubernetes/clusters/1276-core/example/*"
              exclude: true
    template:
      metadata:
        name: "{{path[3]}}.{{path.basenameNormalized}}"
      spec:
        project: default
        source:
          repoURL: https://github.com/techgardencode/homelab.git
          targetRevision: main
          path: "{{path}}"
          plugin:
            name: kustomize-helm
            parameters:
              - name: NAMESPACE
                string: "{{path[3]}}"
        destination:
          name: in-cluster
          namespace: "{{path[3]}}"
        syncPolicy:
          automated:
            selfHeal: true
            prune: true
          syncOptions:
            - ApplyOutOfSyncOnly=true
            - ServerSideApply=true